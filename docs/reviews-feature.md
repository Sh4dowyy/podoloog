# Система отзывов для пользователей

## Обзор

Теперь любой пользователь сайта может оставить отзыв о работе подолога без необходимости регистрации или входа в систему. Все публичные отзывы проходят модерацию администратором перед публикацией.

## Функциональность для пользователей

### Оставление отзыва

1. **Доступ к форме**: На странице `/reviews` пользователи могут нажать кнопку "Jäta arvustus" / "Оставить отзыв"
2. **Заполнение формы**:
   - **Имя**: Обязательное поле
   - **Email**: Обязательное поле (для связи, если необходимо)
   - **Рейтинг**: От 1 до 5 звезд (по умолчанию 5)
   - **Отзыв на эстонском**: Рекомендуется
   - **Отзыв на русском**: Рекомендуется
3. **Валидация**: Требуется заполнить хотя бы одну языковую версию отзыва
4. **Отправка**: После успешной отправки отзыв отправляется на модерацию

### Статусы отзывов

- **На модерации**: Новые отзывы не видны на сайте до одобрения
- **Опубликованы**: Отзывы отображаются на публичной странице
- **Отклонены**: Отзывы не публикуются (пользователь не уведомляется)

## Функциональность для администратора

### Просмотр отзывов

В админ-панели (`/admin/reviews`) отображаются все отзывы:

- **Административные отзывы**: Созданные администратором
- **Публичные отзывы**: Отправленные пользователями (с именем и email)

### Модерация публичных отзывов

1. **Индикатор модерации**: Количество отзывов, ожидающих одобрения, показано в заголовке
2. **Быстрые действия**:
   - ✅ **Одобрить**: Публикует отзыв (зеленая галочка)
   - ❌ **Скрыть**: Снимает отзыв с публикации (желтый крестик)
3. **Полное редактирование**: Возможность изменить содержание отзыва
4. **Удаление**: Полное удаление отзыва из системы

### Информация об авторе

Для публичных отзывов отображается:

- Имя автора
- Email автора
- Пометка "Публичный отзыв"

## Техническая реализация

### API Endpoints

- `POST /api/reviews/public` - Отправка публичного отзыва
- Существующие endpoints для администратора остаются без изменений

### База данных

Добавлены новые поля в таблицу `reviews`:

- `author_name` - Имя автора публичного отзыва
- `author_email` - Email автора публичного отзыва

### Безопасность

- Валидация данных на стороне сервера
- Проверка формата email
- Обязательная модерация всех публичных отзывов
- Ограничение длины полей

## Миграция базы данных

Для существующих инсталляций необходимо выполнить миграцию:

```sql
-- Добавление поддержки публичных отзывов
ALTER TABLE reviews
ADD COLUMN IF NOT EXISTS author_name VARCHAR(255),
ADD COLUMN IF NOT EXISTS author_email VARCHAR(255);

-- Индексы для быстрого поиска
CREATE INDEX IF NOT EXISTS idx_reviews_author_email ON reviews(author_email);
CREATE INDEX IF NOT EXISTS idx_reviews_published ON reviews(published);

-- Ограничения для обеспечения целостности данных
ALTER TABLE reviews
ADD CONSTRAINT check_public_review_info
CHECK (
  (author_id != 'public' AND author_id NOT LIKE 'public_%')
  OR
  (author_name IS NOT NULL AND author_email IS NOT NULL)
);
```

## Будущие улучшения

- Уведомления администратора о новых отзывах
- Система антиспама
- Возможность ответа на отзывы
- Рейтинговая система с агрегацией
- Фильтрация и поиск отзывов
